{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Forgot Password</title>

<!-- Nunito Font -->
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family: 'Nunito', sans-serif;
    height: 100vh;
    width: 100vw;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #a8e6ff, #d7b4ff, #ffe0c9, #c8ffda);
    overflow: hidden;
  }

  .forgot-wrapper {
    position: relative;
    z-index:1;
    max-width: 400px;
    width: 95%;
    padding: 40px 30px 30px 30px;
    background: rgba(255,255,255,0.9);
    border-radius: 20px;
    box-shadow: 0 6px 25px rgba(0,0,0,0.15);
    text-align: center;
  }

  /* Logo at the top */
  .forgot-wrapper img.logo {
    width: 120px;
    height: auto;
    object-fit: contain;
    margin-bottom: 25px;
  }

  h2 {
    font-size: 26px;
    font-weight: 700;
    margin-bottom: 15px;
    color: #064d1b;
  }

  p.description {
    font-size: 14px;
    color: #333;
    margin-bottom: 25px;
    line-height:1.5;
  }

  label {
    display: block;
    text-align: left;
    color: #333;
    font-weight:600;
    margin-bottom:6px;
    margin-top:12px;
  }

  input {
    width: 100%;
    padding:12px;
    border-radius:8px;
    border:1px solid #ccc;
    background: #fff;
    color:#333;
    font-size:1em;
    outline:none;
    transition:0.3s;
  }

  input:focus {
    border-color: #669178;
    box-shadow: 0 0 5px rgba(102,145,120,0.4);
  }

  .otp-boxes {
    display:flex;
    justify-content:center;
    gap:10px;
    margin-top:10px;
  }

  .otp-boxes input {
    width:45px;
    height:45px;
    border-radius:6px;
    border:1px solid #669178;
    background: #fff;
    color:#333;
    font-size:18px;
    text-align:center;
    outline:none;
  }

  button {
    margin-top:20px;
    width:100%;
    padding:12px;
    border:none;
    border-radius:50px;
    background-color: #669178;
    color:#fff;
    font-size:1em;
    font-weight:600;
    cursor:pointer;
    transition:0.3s;
  }

  button:hover {
    background-color:#4d6d57;
  }

  .login-footer {
    margin-top:15px;
  }

  .login-footer a {
    color:#669178;
    font-weight:600;
    text-decoration:none;
  }

  .login-footer a:hover {
    text-decoration: underline;
  }

  .loading {
    font-size: 0.9em;
    color:#333;
    margin-top:10px;
    display:none;
  }

</style>
</head>
<body>

<div class="forgot-wrapper">
  <!-- Full logo -->
  <img src="{% static 'images/logo.png' %}" class="logo" alt="Panchayat Logo">

  <h2>Forgot Password?</h2>
  <p class="description">
    Enter your phone number below. We will send a secure OTP to reset your password safely.
  </p>

  <div id="loading" class="loading">Sending OTP...</div>

  <!-- Step 1 -->
  <form id="step1">
    <label>Phone Number</label>
    <input type="text" id="phone" placeholder="Enter your phone number" />
    <button type="submit">Send OTP</button>
  </form>

  <!-- Step 2 -->
  <form id="step2" style="display:none;">
    <label>Enter OTP</label>
    <div class="otp-boxes" id="otpBoxes">
      <input type="text" maxlength="1">
      <input type="text" maxlength="1">
      <input type="text" maxlength="1">
      <input type="text" maxlength="1">
    </div>

    <label>New Password</label>
    <input type="password" id="newPassword" placeholder="New password">

    <label>Confirm Password</label>
    <input type="password" id="confirmPassword" placeholder="Confirm password">

    <button type="submit">Save Password</button>
  </form>

  <div class="login-footer">
    <a href="{% url 'loginpage' %}">Back to Login</a>
  </div>
</div>

<script>
const step1 = document.getElementById("step1");
const step2 = document.getElementById("step2");
const phoneInput = document.getElementById("phone");
const newPassword = document.getElementById("newPassword");
const confirmPassword = document.getElementById("confirmPassword");
const otpInputs = document.querySelectorAll("#otpBoxes input");
const loadingText = document.getElementById("loading");

step1.addEventListener("submit", function(e){
  e.preventDefault();
  if(phoneInput.value.trim()===""){
    alert("Enter your phone number!");
    return;
  }
  loadingText.style.display="block";
  setTimeout(()=>{
    loadingText.style.display="none";
    step1.style.display="none";
    step2.style.display="block";
  },1000);
});

otpInputs.forEach((input,index)=>{
  input.addEventListener("input",(e)=>{
    if(!/^[0-9]*$/.test(e.target.value)) e.target.value="";
    if(e.target.value && index<otpInputs.length-1) otpInputs[index+1].focus();
  });
});

step2.addEventListener("submit", function(e){
  e.preventDefault();
  const otp = Array.from(otpInputs).map(i=>i.value).join("");
  if(otp.length<4) return alert("Complete OTP!");
  if(newPassword.value !== confirmPassword.value) return alert("Passwords do not match!");
  alert("Password updated successfully!");
  step1.style.display="block";
  step2.style.display="none";
});
</script>

</body>
</html>
